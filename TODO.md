# KioskForge Main Task List

Please notice that the task list of KioskForge is *currently* spread over three sources:

1. This document, which is updated most frequently.
2. The source code itself, these `TODO:` comments are typically intended to be read and acted upon by actual developers.
3. The `Opgaveliste for Kiosk projekt.docx` Word document, which will be eliminated soon.

Use `grep -F TODO: *.py` to see the current list of task items embedded in the source code.

## Open Tasks
- [ ] 2025.03.19.09.47 H Consider to move SHA512 sums for Ubuntu versions into a .INI file so that it is easy to adjust and expand.
- [ ] 2025.03.19.09.11 H Separate `rotate_screen` `xinput` logic from `xrandr` logic as not everybody needs the former.
- [ ] 2025.03.19.07.35 H Protect against "injection attacks": Quote all user-supplied data passed to cloud-init and AutoInstall.
- [ ] 2025.03.19.04.59 H Investigate if `xrandr` is better at providing useful output than `xinput` (requires a touch screen).
- [ ] 2025.03.19.05.33 H Not sure if the `audio` kiosk settings work (`mouse` appears to work just fine).
- [ ] 2025.03.19.04.53 H KioskForge fails to report an error if completely unable to identify the install image.
- [ ] 2025.03.19.04.35 H Investigate if this entry can be used for anything (not very likely):
                         [Get list of touch screens using `xinput`](https://gist.github.com/rubo77/daa262e0229f6e398766?permalink_comment_id=1763721#gistcomment-1763721)
- [ ] 2025.03.19.04.28 H Mark errors **much** more visible, possibly by writing three stars in front of them.
- [ ] 2025.03.19.01.35 H Parse output of `xinput list` and keep all `Virtual core pointer` values but `Virtual core XTEST pointer`:
                         One person on the 'net reported that he or she had to use `Virtual core XTEST pointer` as the choice.
                         Filter out the two Raspberry Pi 4 devices (RPI5?) `vc4-hdmi-0` and `vc4-hdmi-1`.
                         This is the list of devices that need a transformation matrix to operate with a rotated display.
						 Consider or experiment with only keeping values that match `touch` (case-insensitive).
- [ ] 2025.03.16.06.03 H Rewrite all Bash scripts generated by KioskForge into Python3 scripts so as to allow access to the
                         configuration file (`KioskSetup.cfg`) on the target kiosk so that the user *can* change a setting
						 simply by logging in, preferably using SSH, editing `KioskSetup.cfg`, and then rebooting the kiosk.
- [ ] 2025.03.16.03.31 H Make the Kiosk configuration loader and write handle multi-line text lines for the `comment` field.
- [ ] 2025.03.16.03.31 H Consider to add purely administrative fields such as `IP address` and possibly others like that.
- [ ] 2025.03.15.19.15 H Loading a configuration with missing values should auto-assign defaults and report suitable warning(s).
- [ ] 2025.03.15.19.00 H Would it make sense to uninstall `needrestart`?  The kiosk always reboots after upgrading.
                         Yes!  https://discourse.ubuntu.com/t/needrestart-changes-in-ubuntu-24-04-service-restarts/44671/8
- [ ] 2025.03.15.18.58 H Make the `power_save` feature optional.  Check out if other options need to be optional.
- [ ] 2025.03.15.18.52 H Add `target` option: `rpi4`, `rpi5`, `pc`.
- [ ] 2025.03.09.16.28 H Begin using [type_enforced](https://github.com/connor-makowski/type_enforced) globally in the project.
                         This *may* require installing the module via `pip`, but in that case the script should detect that the
						 module is missing and automatically install it (perhaps with a confirmation).
- [ ] 2025.03.09.10.15 H Consider to use tabs for the different configuration sections (General, Network, ...).
- [ ] 2025.03.09.09.55 M GUI on Linux: Check that tkinter is available and perhaps also that X11/Wayland is installed.
- [ ] 2025.03.09.06.39 H Make KioskForge check that it is running on a supported Windows such as Windows 10+.
- [ ] 2025.03.09.00.53 H Make a guide/wizard for the "File/New" menu item so that any user can configure the new kiosk easily.
- [ ] 2025.03.09.00.04 H As KioskForge grows, the need for it to run in a virtual environment probably does too.
                         Only if extra, non-standard packages are used, something which I prefer to avoid.
- [ ] 2025.03.07.07.43 H GUI version: Make a checkbox next to each optional field that disables or enables the input value.
                         This to provide a visual clue on which fields are optional and which are not.
- [ ] 2025.03.05.16.28 H Change `logger` local into a global variable so it is accessible everywhere (crude hack due to laziness).
- [ ] 2025.02.28.02.05 H The `TESTING` variable should use an environment variable rather than a hard-coded value.
- [ ] 2025.02.28.01.48 H Remember to search the KioskForge.py source file for `TODO:` marks.
- [ ] 2025.02.28.01.12 H Consider making a server in Python that the kiosks can report their IP and status to.  Use broadcasts.
- [ ] 2025.02.27.16.48 H Make the configuration include information on what operating system image is being used.  This to allow
                         full reproducibility of already deployed kiosks.  Upgrading cfgs can be done with `sed` or an editor.
- [ ] 2024.11.12.12.47 H Wrap all I/O operations in suitable `try`/`except` statements to avoid crashes on I/O errors.
- [ ] 2025.03.15.18.43 M Add GUI tab for the target device (Raspberry Pi, PC), where overclocking, etc. can be configured.
- [ ] 2025.03.16.06.07 M Add option to enable overclocking of RPI4 and RPI5.
- [ ] 2025.02.27.13.59 M Split the three Kiosk* classes into separate modules so as to be able to run `PyPi` without errors.
- [ ] 2024.11.07.20.33 M Validate setup **much** better so that it can actually be relied on (blank or not is not good enough).
- [ ] 2025.02.27.16.46 M Make the script scriptable by allowing the user to provide a configuration file, a destination, etc.
- [ ] 2025.03.19.10.07 M Consider to add color support to the TUI version of the script, most noticable red colors for errors.
- [ ] 2025.03.19.01.39 L Check if the kiosk supports audio playback at all (when `audio=1`).  People report issues with this:
                         https://forums.raspberrypi.com/viewtopic.php?p=1979825#p1979542
- [ ] 2025.03.09.05.18 L Try out [PyPy](https://github.com/pypy/pypy), it should support Tkinter.  Recommended by Alexandre ("pypy is just a python with jit").  Probably not relevant then due to lack of intensive computing tasks.  The most important thing for KioskForge is that Python is easy to install.
- [ ] 2024.11.12.13.00 L Make the script completely resumable so that it can be rerun over and over again without issues.
                         This could, perhaps, be done by sawing a list of already performed steps or by adding a feature to undo a
						 step that has already been done, although this is a more complicated than just skipping successful steps.
- [ ] 2025.03.05.18.25 L Make the script download the current [Ubuntu Server image](https://cdimage.ubuntu.com/releases/noble/release/ubuntu-24.04.2-preinstalled-server-arm64+raspi.img.xz).

## Completed Tasks
- [x] 2025.03.09.16.44 H I spent like fifteen minutes on trying out `type_enforced` and didn't manage to get it to work.  Most
                         noticably, it doesn't yet really support global enforcement, only per-class and per-function.  Looks good,
						 but probably needs a bit more work before I can use it as I plan to (on all of my code).
- [x] 2025.02.28.05.15 H Add support for Ubuntu Server (and Desktop) v24.04.2 to the operating system detector.
- [x] 2025.03.19.04.45 H TUI version: Suggest to save to same folder as was loaded from.  Don't generate a path.
                         The TUI version already does this, a path is only generated if a configuration wasn't loaded beforehand.
- [x] 2025.03.19.08.08 H Make the `xinput` configuration code in `KioskStart` use device ids rather than device names to avoid
                         the problem that device names either are not found or are listed twice by `xinput`.
- [x] 2025.03.19.01.03 H If using `bcrypt`, passwords can only be 72 chars in length.  Check this in the `Setup()` class.
- [x] 2025.03.15.19.53 H Add `rotate_screen` option: `0`=`normal`, `1`=`left`, `2`=`inverse`, and `3` = `right` (`xrandr` values).
- [x] 2025.03.16.05.34 H Change boolean configuration options into using `0` and `1` as their values instead of `n` and `y`.
- [x] 2025.03.05.16.29 H Figure out why `ExternalAptAction.execute()` does not work when the `lsof` code is enabled then enable it.
                         An `InternalError` exception was thrown in `Result.__init__()` when `status` was zero and `output` empty.
- [x] 2025.03.05.16.35 H Investigate if background `apt` services can be temporarily stopped while running `KioskSetup.py`.
                         Not necessary, I finally found and removed the incorrect parameter check in `Result.__init__()`.
- [x] 2024.11.14.14.00 H Make the script fail graciously if it can see a Linux media but not recognize the version.
- [x] 2025.02.27.16.49 H Remove explanatory comments from configuration files (people use the TUI/GUI to edit these values).
- [x] 2025.02.28.00.56 H I believe I left the Pi on yet it was off after five hours.  I'll try again over the night.
                         This issue has not been recreated, but it *may* be caused by the idle timeout code.  Perhaps a process
						 that is not closed down correctly or Chromium that crashes when restarted.
						 X11 left this error in its log file (`.xsession-errors`):
						 `XIO: fatal IO error 4 (Interrupted system call) on X server ":0" after 4801 requests (4798 known processed) with 0 events remaining.`
						 After which X11 seems to have crashed, pulling down the entire kiosk (into a dead state).
						 I reread the code in `KioskStart.py` and an assignment statement was missing, possibly causing the issue.
						 I am going to make a new kiosk and leave it running through the night.
						 04:25 So far, the box has run without issues, I am confident that the missing assignment statement was the
						 cause of the X11 crash because it meant that a dead process was occasionally attempted killed.
- [x] 2025.02.28.01.44 H I observed cloud-init report "ERROR: Timeout was reached" (?), which could indicate that I am giving
                         cloud-init too much work during the initial boot.  I am going to disable cloud-init upgrades for now.
                         Remember to disable upgrades when using autoinstall.yaml (Subiquity).
- [x] 2025.03.03.15.10 H Make the script report no active internet connection loudly and clearly.
- [x] 2024.11.21.13.58 H Make the script use Linux' 'syslog' facility for logging instead of a local log file.
- [x] 2024.11.08.11.09 H Ask the user if he/she wants to save the changes after having modified the setup (it already does this).
- [x] 2024.11.07.20.27 H Extract all client-dependent options and make them part of the `Setup` class' information:
	1. Cron job, vacuum logs, daily run time (`vacuum_time`).
	2. Cron job, vacuum logs, days (`vacuum_days`).  Default: 7 days.
	3. Cron job, update, upgrade, clean, and reboot the system (`upgrade_time`).
	4. Cron job, shut down the machine (`poweroff_time`).  If blank, no poweroff.
- [x] 2024.11.03.14.28 H Figure out how to autostart `KioskSetup.py` while having a tty (systemd unit or boot stage)?
      Works, but KS messages are interleaved with the console login prompt, and so on.  Not very pretty.
      A preferable solution is to run KioskSetup.py as a quiet script that logs everything reliably.
	  This has been implemented, in March, 2025, as a permanent feature by setting `AUTOSTART` to `True` as this simplifies life
	  enormously for the end-user who no longer needs to log into the kiosk machine to start the configuration process.
- [x] 2024.10.30.13.29 M Figure out a safe way to erase a PC disk quickly prior to installing Ubuntu Server (TOO DANGEROUS).
- [x] 2024.10.30.13.25 H Clean up Logger and console output so that no empty lines appear.
- [x] 2024.10.30.13.25 H Write Lines class, which handles the task of merging lines correctly.
- [x] 2024.10.30.13.26 H Determine the cause of odd error with last few lines of `.bash_startx` missing.
- [x] 2024.10.30.13.34 H Delete line 1372 (`open("lines.txt", ...).write(...)`).
- [x] 2024.11.08.17.38 D Introduce `IntervalField` class to handle the `snap` time interval (much more advanced than that)
- [x] 2025.02.21.16.50 H Ask Darren to get those login credentials for the VHM GitHub account so that I can be added as a user.
                         Nobody knows the credentials and the projects on the `vhm` GitHub account are unused and unknown.
- [x] 2025.02.26.xx.xx H Create a new GitHub user `vhmdk`.
- [x] 2026.02.27.14.10 H Create a new repository `KioskForge` on GitHub for the user `vhmdk`.
- [x] 2025.02.21.17.43 H Ask Darren and Rune what their expectations and wishes for KioskForge v2.x are.
- [x] 2025.02.22.13.58 H Rename the `KioskForge` project to something else - the name is already taken by an Italian entity.
                         Names such as `KioskBuilder`, `KioskSetup`, `OpenKiosk`, `Kiosk Master` were all taken but `KioskForge`
						 turned out to be free, according to Google, so I chose that and have registered the .org domain already.
- [x] 2025.02.26.11.54 M Investigate [Open Kiosk](https://openkiosk.mozdevgroup.com/).  It might be worth a try!  Too complex!
- [x] 2025.02.27.17.21 L Make the script invoke `Raspberry Pi Imager` directly so that the burning step is eliminated:
                         "c:\Program Files (x86)\Raspberry Pi Imager\rpi-imager-cli.cmd" --cli --disable-verify --disable-eject --enable-writing-system-drives "c:\Users\Mikael\Downloads\ubuntu-24.04.2-preinstalled-server-arm64+raspi.img.xz" \\.\PhysicalDrive2
                         This requires finding the physical path of the USB key, which can be done with `wmi` for Python, but I am
                         not happy about the prospect of the user accidentally deleting a drive with valuable data, so this is dropped.
						 Furthermore, it will require the installation of two additional packages for Python, something I doubt the
						 average KioskForge user will be capable of.
