# KioskForge Master Readme File
KioskForge is a portable tool to automate and simplify the process of setting up a new kiosk machine for browsing a website.  It is
intended to be used by somewhat non-technical users to set up a kiosk machine for browsing a given website.

KioskForge currently supports these things:

* Ubuntu Server 24.04.2 on Raspberry Pi 4/4B (2+ GB RAM) ARM64 (aarch64) and PC x64/AMD64 machines.
* Creating a kiosk that allows browsing a website using Chromium in kiosk mode (without an URL address bar).
* Touch screen input insofar the particular touch screen is supported out of the box by the target operating system.
* Ethernet and/or WIFI networking.

**NOTE**: Intel Compute Sticks freeze randomly with Ubuntu Server 24.04.x so they are *not* supported at all.

Customization of the target kiosk machine can be done using KioskForge.py or using an editor to create an INI-style file:

| Name             | INI Field       | Type    | Description                                                                 |
| ---------------- | --------------- | ------  | --------------------------------------------------------------------------- |
| Host name        | `hostname`      | string  | The unqualified domain name of the kiosk machine.                           |
| Time zone        | `timezone`      | string  | The Linux-compatible time zone name (`CET` or `Europe/Copenhagen`).         |
| Locale           | `locale`        | string  | The system locale (`en_US.UTF-8` or a similar value).                       |
| Keyboard layout  | `keyboard`      | string  | The name of the kiosk's keyboard layout (`en`, `dk`, etc.).                 |
| Website URL      | `website`       | string  | The full, canonical URL of the website that is opened in the web browser.   |
| Audio volume     | `audio`         | integer | The logarithmic audio volume from 0 through 100 (0 disables audio).         |
| Mouse cursor     | `mouse`         | boolean | Whether or not the mouse cursor is visible, should normally be disabled.    |
| User login name  | `user_name`     | string  | The Linux user name of the user owning the web browser process, etc.        |
| User password    | `user_code`     | string  | The raw or `bcrypt`-encoded password of the user.                           |
| Public SSH key   | `ssh_key`       | string  | A public SSH key as generated by `ssh-keygen`.                              |
| WIFI network     | `wifi_name`     | string  | The name of the WIFI network to connect to (blank = disable WIFI).          |
| WIFI password    | `wifi_code`     | string  | The password, if any, for the WIFI network (blank = don't use a password).  |
| Snap update time | `snap_time`     | period  | A period of time, from start to end, when the Snap update process may run.  |
| Swap file size   | `swap_size`     | integer | The size of the swap file in gigabytes (0 = disable swap, not recommended). |
| APT update time  | `upgrade_time`  | time    | The hour and minute of when to perform a global upgrade of packages.        |
| Shutdown time    | `poweroff_time` | time    | The hour and minute of when to automatically shut down the kiosk machine.   |
| Vacuum time      | `vacuum_time`   | time    | The hour and minute of when to automatically compact and clean log files.   |
| Vacuum retention | `vacuum_days`   | integer | The number of days to retain system logs.                                   |
| Idle timeout     | `idle_timeout`  | seconds | Seconds of idle time before restarting the web browser (0 = never).         |
| Screen rotation  | `rotate_screen` | integer | 0 = default, 1 = rotate left, 2 = flip upside-down, 3 = rotate right.       |


## Philosophy
KioskForge is designed and implemented using three primary requirements:

1. The script must be completely reliable.  This is why we use Python and its exception handling instead of, say, a Bash script.
2. The script must be as user-friendly as possible.  Most people who need a kiosk aren't particularly tech savvy.
3. The script must be portable to all major platforms, Windows and Linux in particular.  This is why we use Tkinter for Python.

It does not matter the least if the script is ugly, a bit clumsy, somewhat suboptimal in terms of execution speed or algorithms.
People probably only use the script occasionally, albeit we want to automate it as much as possible in the future.


## Usage
KioskForge is a simple application that allows you to create, load, edit, and save a *kiosk configuration* - an INI-style file
that defines the kiosk and what it is supposed to do.  After that, you can choose to *update* an installation media to apply the
configuration during installation.

As of now, the procedure is as follows:

1. Create an appropriate Ubuntu Server 24.04.2 installation media (a USB key or a MicroSD card) using
   [Raspberry Pi Imager](https://www.raspberrypi.com/software/).  Make sure you **don't** use *OS Customisations*.
   When done, leave the installation media in your computer until KioskForge tells you to dismount it or safely remove it.
   Also, be sure to **not** select `Ubuntu Desktop` as this won't work (KioskForge will detect this issue, though).
2. Launch KioskForge as described below.
3. Create a new configuration using menu item `1` or load an existing configuration using menu item `2`.
4. Edit the configuration to ensure that the configuration is correct using menu item `3`.
5. Save the changed configuration, if it has been modified, using menu item `4`.
5. Select the `Update Raspberry Pi Imager prepared installation media` (`5`) to have KioskForge modify the install media so that
   it installs and launches an actual Linux kiosk with the Chromium web browser pointing to whatever URL you have configured.
6. Press `ENTER` to exit KioskForge.
7. Use Windows' *Safe Removal* feature or `Eject` from Windows Explorer to safely unmount the installation media.
8. Move the installation media to the powered off Raspberry Pi 4+.
9. Power on the Raspberry Pi 4+.
10. Wait between 15 and 30 minutes (this depends a lot on the I/O speed of the installation media) until the kiosk has been forged,
    which is shown by the kiosk rebooting into kiosk mode showing the requested URL.
11. Try out and test the new kiosk.  If you find issues, please report them (see the section `Bugs` below).
12. You can either attach a keyboard or SSH into the box (if you know its LAN IP address) to power it off.
13. Mount the Raspberry Pi in whatever enclosure you are using for your kiosk.

After that, the kiosk should *theoretically* run nicely and reliably for years and years.  However, you may want to log into it,
using SSH, once in a while to verify that logs are being rotated, that there is sufficient disk space available, and so on.

If you SSH into the kiosk or use a local keyboard to log in, you can use the `kiosklog` command to view `syslog` entries related
to KioskForge.  If you only want to view *errors*, append the option `-p 3`: `kiosklog -p 3 | more`.


### Windows
On Windows, you need to download and install Python from [Python v3.x programming language](https://python.org).

After this, you can launch KioskForge directly from Windows Explorer, by double-clicking it, or directly from the command-line.


### Linux
`KioskForge.py` currently **cannot** be run on Linux.  This is work in progress and is expected to be solved pretty soon.

Install a recent version of the [Python v3.x programming language](https://python.org).  On most Linuxes, this can be done with the
system-wide package manager such as `apt`, `dnf`, `pacman`, and so on.

You need to make sure that the script, `KioskForge.py`, has execute permissions (use `chmod u+x KioskForge.py` to accomplish that),
then you can invoke it using `sudo ./KioskForge.py`.


## Macintosh
I don't have access to a Mac computer, so no development or testing is done on this platform.  Feel free to port the script and
submit a pull request.  Please make sure that the result generates a valid, reliable kiosk before submitting the pull request.


## Issues
The following known issues exist with KioskForge:

1. The `rotate_screen` option does not work with touch screens, only the display is rotated (the mouse is not affected).
   A solution for this has been implemented on March 19th, 2025, but I cannot test it due to lack of a touch screen.


## Development
To develop on KioskForge, install a recent Python v3.x and MyPy, and then set up these environment variables:

| Environment Variable      | Value | Explanation                                                                             |
| ------------------------- | ----- | --------------------------------------------------------------------------------------- |
| `PYTHONDONTWRITEBYTECODE` | `1`   | Disable the generation of needless Python byte-code files everywhere.                   |
| `RAMDISK` 				| path  | A temporary folder, preferably on a ram disk.  This is used for caching MyPy data, etc. |

Run the script `test.bat` (Windows only) or `test.sh` (Linux only) to make MyPy test the code and report any errors.

*Currently, the MyPy test is a bit broken because the script uses both Windows-only and Linux-only features, something which
MyPy isn't all that happy about.  This will be fixed in not too long by splitting the single script into its logical parts.*

Development currently takes place on a Windows 11 Pro desktop computer, but I'll setup a Linux development environment soon.


## Bugs
Please report bugs on [KioskForge Issues at GitHub](https://github.com/vhmdk/KioskForge/issues) or by mail to
[Mikael Egevig](mailto:me@vhm.dk).  The former is the preferred method, but use whichever suits you best.

When you report a bug, please try to run this command to create a log file:

```bash
kiosklog > kiosk.log
```

Then please include the two files `~/.xsession-errors` and `kiosk.log` in your bug report.  These files may provide invaluable
information to me about the issue.


